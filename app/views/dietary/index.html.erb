<div class="row mb-5">
  <div class="col">
    <div class="card">
      <div class="card-body">
        <h4 class="header-title">Pautas Alimenticias</h4>
        <div class="data-tables datatable-dark">
          <div class="d-flex justify-content-between">
            <div><button id="btn-show-all-children" type="button" class="btn btn-primary"><i class="fa fa-expand "></i>&nbsp;&nbsp;Mostrar Detalles</button>
              <button id="btn-hide-all-children" type="button" class="btn btn-light"><i class="fa fa-compress"></i>&nbsp;&nbsp;Colapsar</button></div>
            <button id="btn-update-guideline" type="button" class="btn btn-primary" ><i class="fa fa-save "></i>&nbsp;&nbsp;Guardar pauta</button></div>
        </div>
        <hr>
        <div class="">
          <button id="btn-refresh-guideline" type="button" class="btn btn-primary btn-lg btn-block"><i class="fa fa-cogs"></i>Generar nueva pauta semanal</button></div>
      </div>
      <hr>
      <table id="dietary" class="display" cellspacing="0" width="100%">
        <thead>
          <tr>
            <th></th>
            <th>Tiempo</th>
            <th>Lunes</th>
            <th>Martes</th>
            <th>Miercoles</th>
            <th>Jueves</th>
            <th>Viernes</th>
            <th>Sabado</th>
            <th>Domingo</th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <th></th>
            <th>Tiempo</th>
            <th>Lunes</th>
            <th>Martes</th>
            <th>Miercoles</th>
            <th>Jueves</th>
            <th>Viernes</th>
            <th>Sabado</th>
            <th>Domingo</th>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
</div>
</div>
<div class="row mb-5">
  <div class="col">
    <div class="card">
      <div class="card-body">
        <ul class="list-group">
          <% @totales_ingredients.each do |ingredient| %>
            <li class="list-group-item"><%= ingredient.name %></li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>
<script>
  /* Formatting function for row details - modify as you need */
  
  // console.log(<%= raw @arrayRecipes.to_json %>);
  // console.log(<%= raw @arrayIDsRecipes.to_json %>);
  
  let arrayIdsRecipes = <%= raw @arrayIDsRecipes.to_json %>;
  
    function format ( d ) {
       return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">'+
           '<tr>'+
               '<td>Lunes:</td>'+
               '<td>'+d.lunes+'</td>'+
           '</tr>'+
          //  '<tr>'+
          //      '<td>Extension number:</td>'+
          //      '<td>'+d.extn+'</td>'+
          //  '</tr>'+
          //  '<tr>'+
          //      '<td>Extra info:</td>'+
          //      '<td>And any further details here (images etc)...</td>'+
          //  '</tr>'+
       '</table>';
    }
  
  
    function UpdateGuideline(){
      const obj = {"lunes": [], "martes": [], "miercoles": [], "jueves": [], "viernes": [], "sabado": [], "domingo": []};
      arrayIdsRecipes.forEach(element => {
        obj.lunes.push(parseInt(element.lunes));
        obj.martes.push(parseInt(element.martes));
        obj.miercoles.push(parseInt(element.miercoles));
        obj.jueves.push(parseInt(element.jueves));
        obj.viernes.push(parseInt(element.viernes));
        obj.sabado.push(parseInt(element.sabado));
        obj.domingo.push(parseInt(element.domingo));
      });
  
      $.ajax({
        type: "POST",
        url: '/dietary',
        beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
        contentType: 'application/json',
        dataType: 'json',
        data : JSON.stringify({ "guidelines" : [obj]}),
        cache: true, // otherwise will get fresh copy every page load
        success: function(data) {
          refresh()
        }
      })
  
  
    }
  
    function refresh() {
        location.reload();
    }
  
  $(document).ready(function() {
    $('#btn-update-guideline').click(UpdateGuideline)
    $('#btn-refresh-guideline').click(refresh)
    var data = <%= raw @arrayRecipes.to_json %>;
  
  
  
     var table = $('#dietary').DataTable({
  			"dom": '<"dt-buttons"Bf><"clear">lirtp',
        // dom:
        //     "<'row'<'col-sm-12 text-left d-flex justify-content-start'f>>" +
        //     "<'row'<'col-sm-12 text-right d-flex justify-content-end'B>>"+
        //     "<'row'<'col-sm-12'tr>>"+
        //     "<'row'<'col-sm-12 col-md-12'i><'col-sm-12 col-md-12 dataTables_pager'lp>>",
        buttons: [
          { extend: 'copy', text: 'Copiar' },
          { extend: 'excel', text: 'Excel' },
          { extend: 'pdf', text: 'PDF' },
          { extend: 'colvis', text: 'Ocultar columnas' },
          { extend: 'colvisRestore', text: 'Restaurar columnas' },
        ],
       "scrollY":        "500px",
       language: {
        "decimal": "",
        "emptyTable": "No hay informaci√≥n",
        "info": "Mostrando _START_ a _END_ de _TOTAL_ Entradas",
        "infoEmpty": "Mostrando 0 to 0 of 0 Entradas",
        "infoFiltered": "(Filtrado de _MAX_ total entradas)",
        "infoPostFix": "",
        "thousands": ",",
        "lengthMenu": "Mostrar _MENU_ Entradas",
        "loadingRecords": "Cargando...",
        "processing": "Procesando...",
        "search": "Buscar:",
        "zeroRecords": "Sin resultados encontrados",
        "paginate": {
            "first": "Primero",
            "last": "Ultimo",
            "next": "Siguiente",
            "previous": "Anterior"
        }
    },
          data: data,
         'columns': [
             {
                 'className':      'details-control',
                 'orderable':      false,
                 'data':           null,
                 'defaultContent': ''
             },
             { 'data': 'tiempo' },
             { 'data': 'lunes' },
             { 'data': 'martes' },
             { 'data': 'miercoles' },
             { 'data': 'jueves' },
             { 'data': 'viernes' },
             { 'data': 'sabado' },
             { 'data': 'domingo' },
         ],
         'order': [[1, 'asc']]
     } );
  
     // Add event listener for opening and closing details
     $('#dietary tbody').on('click', 'td.details-control', function(){
         var tr = $(this).closest('tr');
         var row = table.row( tr );
  
         if(row.child.isShown()){
             // This row is already open - close it
             row.child.hide();
             tr.removeClass('shown');
         } else {
             // Open this row
             row.child(format(row.data())).show();
             tr.addClass('shown');
         }
     });
  
     // Handle click on "Expand All" button
     $('#btn-show-all-children').on('click', function(){
         // Enumerate all rows
         table.rows().every(function(){
             // If row has details collapsed
             if(!this.child.isShown()){
                 // Open this row
                 this.child(format(this.data())).show();
                 $(this.node()).addClass('shown');
             }
         });
     });
  
  
  
        table.buttons().container()
        .appendTo( '#dietary_wrapper .col-md-12:eq(0)' );
  });
</script>
<style>
  td.details-control {
      background: url('https://cdn.rawgit.com/DataTables/DataTables/6c7ada53ebc228ea9bc28b1b216e793b1825d188/examples/resources/details_open.png') no-repeat center center;
      cursor: pointer;
  }
  tr.shown td.details-control {
      background: url('https://cdn.rawgit.com/DataTables/DataTables/6c7ada53ebc228ea9bc28b1b216e793b1825d188/examples/resources/details_close.png') no-repeat center center;
  }
  .form-control {
    display: inline;
    width: 100%;
    height: calc(2.25rem + 2px);
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    line-height: 1.5;
    color: #495057;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #ced4da;
    border-radius: 0.25rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
  }
</style>